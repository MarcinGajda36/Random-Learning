using BenchmarkDotNet.Attributes;
using MarcinGajda.Collections;

namespace Benchmarks;

[MemoryDiagnoser]
[RankColumn]
public class Sorting
{
    //[Params(2, 3, 4, 5, 6, 7, 8, 9, 10, 11)]
    //public int BidsInGroup { get; set; }

    [Params(8, 64, 512, 2_048, 32_768, 65_536)]
    public int ArrayLength { get; set; }

    private uint[] array;

    [IterationSetup]
    public void Setup()
    {
        array = new uint[ArrayLength];
        for (uint i = 0; i < array.Length; i++)
        {
            unchecked
            {
                array[i] = i * 2654435769u;
            }
        }
    }

    [Benchmark]
    public void Radix()
    {
        array.RadixSort(8);
    }

    [Benchmark]
    public void ArraySort()
    {
        Array.Sort(array);
    }

    [Benchmark]
    public void LinqSort()
    {
        array.OrderBy(x => x).ToArray();
    }
}
// | Method | BidsInGroup | ArrayLength |         Mean |      Error |     StdDev |       Median | Rank | Allocated |
// |------- |------------ |------------ |-------------:|-----------:|-----------:|-------------:|-----:|----------:|
// |  Radix |           2 |           8 |     1.849 us |  0.0731 us |  0.2122 us |     1.800 us |    2 |   1.28 KB |
// |  Radix |           2 |          64 |     4.310 us |  0.0891 us |  0.1759 us |     4.300 us |    9 |   1.28 KB |
// |  Radix |           2 |         512 |    25.300 us |  0.3053 us |  0.2550 us |    25.300 us |   21 |   1.28 KB |
// |  Radix |           2 |        2048 |    97.927 us |  1.3818 us |  1.2925 us |    97.400 us |   30 |   1.28 KB |
// |  Radix |           2 |       32768 | 1,599.987 us | 10.2454 us |  9.5835 us | 1,597.900 us |   41 |   1.28 KB |
// |  Radix |           2 |       65536 | 3,273.200 us | 24.4553 us | 21.6790 us | 3,275.050 us |   47 |   1.28 KB |
// |  Radix |           3 |           8 |     1.492 us |  0.0468 us |  0.1329 us |     1.500 us |    1 |   1.28 KB |
// |  Radix |           3 |          64 |     3.433 us |  0.0701 us |  0.1171 us |     3.400 us |    7 |   1.28 KB |
// |  Radix |           3 |         512 |    17.608 us |  0.2562 us |  0.2139 us |    17.600 us |   20 |   1.28 KB |
// |  Radix |           3 |        2048 |    68.211 us |  1.3581 us |  1.5096 us |    67.700 us |   29 |   1.28 KB |
// |  Radix |           3 |       32768 | 1,138.715 us | 12.2942 us | 16.8284 us | 1,134.150 us |   39 |   1.28 KB |
// |  Radix |           3 |       65536 | 2,345.040 us | 37.0773 us | 42.6983 us | 2,327.900 us |   45 |   1.28 KB |
// |  Radix |           4 |           8 |     1.510 us |  0.0538 us |  0.1552 us |     1.500 us |    1 |   1.28 KB |
// |  Radix |           4 |          64 |     2.802 us |  0.0579 us |  0.1364 us |     2.800 us |    5 |   1.28 KB |
// |  Radix |           4 |         512 |    13.327 us |  0.2694 us |  0.2520 us |    13.300 us |   19 |   1.28 KB |
// |  Radix |           4 |        2048 |    49.392 us |  0.3474 us |  0.2712 us |    49.300 us |   28 |   1.28 KB |
// |  Radix |           4 |       32768 | 1,797.931 us | 13.1568 us | 10.9865 us | 1,796.900 us |   43 |   1.28 KB |
// |  Radix |           4 |       65536 | 4,008.614 us | 11.1835 us |  9.9138 us | 4,009.700 us |   49 |   1.28 KB |
// |  Radix |           5 |           8 |     1.592 us |  0.0640 us |  0.1877 us |     1.600 us |    1 |   1.28 KB |
// |  Radix |           5 |          64 |     2.773 us |  0.0540 us |  0.1459 us |     2.700 us |    5 |   1.28 KB |
// |  Radix |           5 |         512 |    11.918 us |  0.2264 us |  0.2325 us |    11.900 us |   18 |   1.28 KB |
// |  Radix |           5 |        2048 |    43.806 us |  0.7854 us |  0.8066 us |    43.500 us |   27 |   1.28 KB |
// |  Radix |           5 |       32768 | 1,699.847 us | 16.3765 us | 15.3186 us | 1,708.300 us |   42 |   1.28 KB |
// |  Radix |           5 |       65536 | 3,441.421 us | 11.8457 us | 10.5009 us | 3,439.900 us |   48 |   1.28 KB |
// |  Radix |           6 |           8 |     1.777 us |  0.0394 us |  0.1138 us |     1.750 us |    2 |   1.28 KB |
// |  Radix |           6 |          64 |     2.809 us |  0.0576 us |  0.0914 us |     2.800 us |    5 |   1.28 KB |
// |  Radix |           6 |         512 |    10.767 us |  0.1924 us |  0.1799 us |    10.700 us |   17 |   1.28 KB |
// |  Radix |           6 |        2048 |    38.770 us |  0.6260 us |  0.7917 us |    38.500 us |   26 |   1.28 KB |
// |  Radix |           6 |       32768 |   938.580 us | 12.0604 us | 11.2813 us |   932.300 us |   37 |   1.28 KB |
// |  Radix |           6 |       65536 | 2,871.397 us | 35.8967 us | 33.5778 us | 2,857.750 us |   46 |   1.28 KB |
// |  Radix |           7 |           8 |     1.999 us |  0.0527 us |  0.1512 us |     2.000 us |    3 |   1.28 KB |
// |  Radix |           7 |          64 |     2.905 us |  0.0579 us |  0.1633 us |     2.900 us |    5 |   1.28 KB |
// |  Radix |           7 |         512 |     9.458 us |  0.1799 us |  0.2339 us |     9.450 us |   15 |   1.28 KB |
// |  Radix |           7 |        2048 |    32.360 us |  0.2764 us |  0.2586 us |    32.400 us |   25 |   1.28 KB |
// |  Radix |           7 |       32768 |   791.125 us |  4.2513 us |  3.3191 us |   791.250 us |   35 |   1.28 KB |
// |  Radix |           7 |       65536 | 1,906.833 us |  8.6628 us |  8.1031 us | 1,905.300 us |   44 |   1.28 KB |
// |  Radix |           8 |           8 |     2.625 us |  0.0772 us |  0.2177 us |     2.600 us |    4 |   1.28 KB |
// |  Radix |           8 |          64 |     3.255 us |  0.0662 us |  0.1561 us |     3.200 us |    6 |   1.28 KB |
// |  Radix |           8 |         512 |     8.644 us |  0.1722 us |  0.3016 us |     8.600 us |   13 |   1.28 KB |
// |  Radix |           8 |        2048 |    26.676 us |  0.2772 us |  0.3300 us |    26.600 us |   22 |   1.28 KB |
// |  Radix |           8 |       32768 |   527.764 us |  2.8261 us |  2.5053 us |   526.550 us |   33 |   1.28 KB |
// |  Radix |           8 |       65536 | 1,126.521 us |  3.9385 us |  3.4913 us | 1,126.250 us |   39 |   1.28 KB |
// |  Radix |           9 |           8 |     3.903 us |  0.0794 us |  0.1189 us |     3.900 us |    8 |   1.28 KB |
// |  Radix |           9 |          64 |     4.794 us |  0.0995 us |  0.2285 us |     4.800 us |   10 |   1.28 KB |
// |  Radix |           9 |         512 |     9.938 us |  0.1731 us |  0.1446 us |     9.900 us |   16 |   1.28 KB |
// |  Radix |           9 |        2048 |    28.133 us |  0.2638 us |  0.2060 us |    28.200 us |   23 |   1.28 KB |
// |  Radix |           9 |       32768 |   640.786 us |  2.1797 us |  1.9323 us |   641.200 us |   34 |   1.28 KB |
// |  Radix |           9 |       65536 | 1,441.420 us |  9.4699 us |  8.8582 us | 1,438.100 us |   40 |   1.28 KB |
// |  Radix |          10 |           8 |     6.272 us |  0.1269 us |  0.2119 us |     6.200 us |   11 |   1.28 KB |
// |  Radix |          10 |          64 |     7.608 us |  0.1503 us |  0.1954 us |     7.600 us |   12 |   1.28 KB |
// |  Radix |          10 |         512 |    12.879 us |  0.2130 us |  0.1888 us |    12.850 us |   19 |   1.28 KB |
// |  Radix |          10 |        2048 |    30.838 us |  0.2471 us |  0.2063 us |    30.900 us |   24 |   1.28 KB |
// |  Radix |          10 |       32768 |   482.973 us |  2.7338 us |  2.5572 us |   482.200 us |   32 |   1.28 KB |
// |  Radix |          10 |       65536 | 1,031.057 us |  8.6846 us |  8.1236 us | 1,029.750 us |   38 |   1.28 KB |
// |  Radix |          11 |           8 |     9.443 us |  0.0961 us |  0.0852 us |     9.450 us |   15 |   1.28 KB |
// |  Radix |          11 |          64 |     8.971 us |  0.1429 us |  0.1267 us |     8.950 us |   14 |   1.28 KB |
// |  Radix |          11 |         512 |    13.117 us |  0.2509 us |  0.2684 us |    13.000 us |   19 |   1.28 KB |
// |  Radix |          11 |        2048 |    28.158 us |  0.3474 us |  0.2712 us |    28.100 us |   23 |   1.28 KB |
// |  Radix |          11 |       32768 |   379.320 us |  2.2331 us |  2.0888 us |   379.000 us |   31 |   1.28 KB |
// |  Radix |          11 |       65536 |   815.787 us |  6.6442 us |  6.2149 us |   815.000 us |   36 |   1.28 KB |

// Radix bidsInGroup = 8
// |    Method | ArrayLength |           Mean |        Error |       StdDev |         Median | Rank | Allocated |
// |---------- |------------ |---------------:|-------------:|-------------:|---------------:|-----:|----------:|
// |     Radix |           8 |     2,640.5 ns |     55.27 ns |    138.65 ns |     2,600.0 ns |    4 |    1312 B |
// | ArraySort |           8 |       319.8 ns |     27.37 ns |     78.97 ns |       300.0 ns |    1 |     640 B |
// |  LinqSort |           8 |     1,860.7 ns |     32.70 ns |     87.84 ns |     1,900.0 ns |    3 |    1040 B |
// |     Radix |          64 |     3,136.1 ns |     55.69 ns |     93.05 ns |     3,100.0 ns |    5 |    1312 B |
// | ArraySort |          64 |     1,325.0 ns |     35.50 ns |    100.14 ns |     1,300.0 ns |    2 |     640 B |
// |  LinqSort |          64 |     5,700.0 ns |    113.87 ns |    166.90 ns |     5,700.0 ns |    6 |    1936 B |
// |     Radix |         512 |     8,606.7 ns |    170.05 ns |    254.52 ns |     8,550.0 ns |    7 |    1312 B |
// | ArraySort |         512 |    14,278.6 ns |    274.29 ns |    243.15 ns |    14,350.0 ns |    8 |     640 B |
// |  LinqSort |         512 |    47,331.2 ns |    865.36 ns |  1,347.26 ns |    46,650.0 ns |   10 |    9104 B |
// |     Radix |        2048 |    26,741.7 ns |    391.78 ns |    305.88 ns |    26,700.0 ns |    9 |    1312 B |
// | ArraySort |        2048 |    66,564.3 ns |    859.80 ns |    762.19 ns |    66,200.0 ns |   11 |     640 B |
// |  LinqSort |        2048 |   224,400.0 ns |    955.53 ns |    797.91 ns |   224,100.0 ns |   12 |   33680 B |
// |     Radix |       32768 |   528,346.2 ns |  2,835.84 ns |  2,368.06 ns |   527,800.0 ns |   13 |    1312 B |
// | ArraySort |       32768 | 1,384,692.9 ns |  1,976.02 ns |  1,751.69 ns | 1,384,250.0 ns |   15 |     640 B |
// |  LinqSort |       32768 | 5,061,646.7 ns | 64,825.90 ns | 60,638.19 ns | 5,042,200.0 ns |   17 |  525200 B |
// |     Radix |       65536 | 1,126,625.0 ns |  1,491.84 ns |  1,164.73 ns | 1,126,500.0 ns |   14 |    1312 B |
// | ArraySort |       65536 | 2,977,278.6 ns | 14,632.38 ns | 12,971.22 ns | 2,972,900.0 ns |   16 |     640 B |
// |  LinqSort |       65536 | 8,799,361.8 ns | 59,198.93 ns | 95,595.25 ns | 8,818,150.0 ns |   18 | 1049488 B |